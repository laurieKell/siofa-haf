---
title: "SIOFA Sharks"
subtitle: "Length Based Indicators"
author: "DELEGATION OF THE EUROPEAN UNION"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

## Introduction

Length-based indicators (LBIs) are useful for assessing shark stocks, based on the size composition of catch or survey data to provide insights into the status of fish stocks. Especially when traditional assessment methods are not applicable due to data limitations.

Here provides a summary of the shark dataset, which includes information 
on shark captures such as species, length, weight, sex, maturity, and other relevant data. The aim is to understand the diversity of species, the types of data collected, and assess the quality and coverage of the dataset.


```{r, knitr, eval=TRUE, echo=FALSE, warning=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(knitr)
opts_chunk$set(cache     =TRUE, 
               comment   =NA, 
               warning   =FALSE, 
               message   =FALSE, 
               error     =FALSE, 
               echo      =FALSE, 
               eval      =TRUE,
               cache     =TRUE,
               cache.path= "cache/lbi/",
               fig.path  ="../figs/lbi/",
               fig.width =12,
               fig.height=8,
               dev       ="png")
iFig=0
iTab=0
```

```{r lib, include=FALSE}
library(openxlsx)  # For reading Excel files
library(lubridate) # For handling date and time
library(plyr)      # For data manipulation
library(dplyr)     # For data manipulation
library(reshape)   # For data manipulation
library(ggplot2)   # For plotting
library(ggpubr)    # For plotting
library(mapdata)   # For map-based data
library(viridis)   # For color scales, better for visibility
```

```{r, setwd, eval=FALSE}
setwd("/home/laurie/Desktop/active/sofia-haf/Rmd")
```

## Dataset Overview
```{r, data}
load("../data/Sharks_biological.Rdata")
biol=as.data.frame(biol)
names(biol)[c(3,5,6,7,12)]=c("len","mass","sex","mat","species")

load("../data/Sharks_logbooks.Rdata")
cpue=as.data.frame(cpue)

biol=merge(biol,cpue[,c("cod_set","month","year","Area")],by=c("cod_set"))
names(biol)=tolower(names(biol))
```


## Maturity 

### Females
1: immature; 2: maturing; 3: mature; 4: uterine developing; 5: differentiating; 6: expecting; 7: post-natal, spent; 8: Re-starting development

### Males
1: immature; 2: developing; 3: mature; 4: active

```{r, data}
mat=setNames(seq(4),c("A","B","C","D"))
biol$mat[biol$mat%in%names(mat)]=mat[biol$mat[biol$mat%in%names(mat)]]
biol$mat=substr(biol$mat,nchar(biol$mat),1)
```

### Species

```{r species-count}
sort(unique(biol$Scientific_name))
```


# Best Length-Based Indicators for Shark Stocks

## 1. Length Frequency Distribution

- **Description:** Analysis of length frequency distribution can reveal shifts in population structure, indicating changes in recruitment, growth rates, or fishing pressure.

- **Utility:** Helps understand the age structure and can indicate overfishing if larger, older individuals become rare.

## 2. Mean Length

- **Description:** The average length of individuals in the catch or population over time.
- **Utility:** A declining mean length can indicate heavy fishing pressure or overexploitation.

## 3. Length at First Capture (L50)

- **Description:** The length at which 50% of individuals are susceptible to capture.
- **Utility:** If L50 is much lower than the length at maturity (Lm), it suggests unsustainable fishing practices.

## 4. Proportion of Mature Individuals

- **Description:** The percentage of the catch that is mature, assessed through length.
- **Utility:** A decrease over time can indicate overfishing.

## 5. Large Fish Indicator (LFI)

- **Description:** The proportion of fish above a certain length threshold.
- **Utility:** Useful for detecting shifts towards smaller sizes, indicating overexploitation.

## 6. Size at Maturity (Lm)

- **Description:** The length at which a certain percentage of the population reaches sexual maturity.
- **Utility:** Important for ensuring sharks reach maturity before being caught.

## 7. Growth Rates and Maximum Size (Lâˆž)

- **Description:** Estimated from length-at-age data to understand population dynamics.
- **Utility:** Inform on the health of the stock and the efficacy of current management strategies.

# Conclusion

Applying LBIs requires consideration of species-specific life history traits of sharks and the type of fisheries they are subjected to. Using multiple indicators in tandem is recommended for a comprehensive view of the stock status. Management strategies should be adaptive, considering the ecological roles of sharks, their vulnerability to overfishing, and the socio-economic context of the fisheries.

```{r}
pDog=merge(subset(biol,species=="Centroscymnus coelolepis"),
           cpue[!duplicated(cpue[,"cod_set"]),c("cod_set","year","month","Area")])
pDog=subset(pDog,year>2018)

gghistogram(pDog,x="len")+
  coord_flip()+  
  #scale_x_reverse()+ 
  facet_grid(sex~year,scale="free")+
  xlab("Length")+
  geom_vline(aes(xintercept=V1),    data=ddply(pDog,.(year,sex), with, 
                                               mean(len)), col="blue")+
  geom_vline(aes(xintercept=V1),    data=ddply(pDog,.(year,sex), with, 
                                               mean(len[mat==0.5])), col="red")+
  #geom_vline(aes(xintercept=lmean), data=dt2,col="blue")+
  #scale_x_continuous(limits=c(0,60))+
  scale_fill_manual("Component",values=c("red","blue"))+
  theme_bw(16)+
  theme(legend.position = "bottom", 
                    #axis.title.y = element_blank(), 
                    #axis.text.y  = element_blank(), 
                    #axis.ticks.y = element_blank(), 
                    axis.text.x  = element_blank(), 
                    axis.ticks.x = element_blank())

```

